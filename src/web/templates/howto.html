{% extends "base.html" %}

{% block title %}How to Play{% endblock %}
{% block page_class %} narrower{% endblock %}

{% block nav %}
  <nav class="nav-bar">
    <a class="nav-home" href="{{ url_for('public.index') }}">The Last Ember</a>
    <span class="nav-sep">Â·</span>
    <a class="nav-link" href="{{ url_for('public.chronicle') }}">Chronicle</a>
    <a class="nav-link active" href="{{ url_for('public.howto') }}">How to Play</a>
    <a class="nav-link" href="{{ url_for('public.join') }}">Join</a>
  </nav>
{% endblock %}

{% block content %}
  <div class="page-header" style="padding-top:48px;">
    <h1 class="page-title">How to Play</h1>
    <p class="page-subtitle">A text adventure played over radio. Five minutes a day. Thirty days an epoch. No internet required.</p>
  </div>

  {# â•â•â• WHAT IS THIS â•â•â• #}
  <div class="divider">What is meshMUD</div>

  <p class="prose">meshMUD is a multiplayer text adventure that runs over <strong>Meshtastic</strong> â€” a long-range radio mesh network. There is no internet connection, no app store, no account creation. You play by sending short text messages from your Meshtastic node. The game responds. Everything happens in 150 characters or less.</p>

  <p class="prose">It plays like the BBS door games of the early '90s â€” <em class="place">Legend of the Red Dragon</em>, <em class="place">TradeWars 2002</em> â€” adapted for radio. Short daily sessions. Asynchronous multiplayer. A shared world where you see evidence of other players without needing to be online at the same time. A dungeon that resets every 30 days.</p>

  <p class="prose">You don't need to be a gamer. You don't need to be fast. You need a Meshtastic radio and five minutes.</p>

  <div class="callout ember">
    <div class="callout-label">The basics</div>
    <p class="prose">You wake up in a tavern called <em class="place">The Last Ember</em>. Below it is a dungeon that changes every 30 days. You explore it, fight monsters, find secrets, and help other players push deeper â€” all by typing short commands over your radio. When the 30 days end, the dungeon resets. Your character persists. The stories stay.</p>
  </div>

  {# â•â•â• GETTING STARTED â•â•â• #}
  <div class="divider">Getting Started</div>

  <p class="prose">If your mesh network is running meshMUD, the game server listens for direct messages from any node. Send it a DM and it responds. That's it.</p>

  <div class="flow-steps">
    <div class="flow-step">
      <div class="flow-step-num">1</div>
      <div class="flow-step-content">
        <div class="flow-step-label">Send a DM to the game node</div>
        <div class="flow-step-text">Find the meshMUD node on your Meshtastic client and send any message. The server responds with a welcome and asks you to pick a class.</div>
      </div>
    </div>
    <div class="flow-step">
      <div class="flow-step-num">2</div>
      <div class="flow-step-content">
        <div class="flow-step-label">Pick your class</div>
        <div class="flow-step-text">One letter. <code>W</code> for Warrior, <code>G</code> for Guardian, <code>S</code> for Scout. That's your only creation choice â€” everything else emerges through play.</div>
      </div>
    </div>
    <div class="flow-step">
      <div class="flow-step-num">3</div>
      <div class="flow-step-content">
        <div class="flow-step-label">You're in</div>
        <div class="flow-step-text">The server drops you in <em class="place">The Last Ember</em> with starting gear and a handful of gold. Type <code>L</code> to look around. Type <code>H</code> for help. You're playing.</div>
      </div>
    </div>
  </div>

  <div class="msg-example">
    <span class="msg-player">You â†’ meshMUD:</span> <span class="msg-gold">hello</span><br>
    <span class="msg-server">meshMUD:</span> Welcome to The Last Ember. Pick a class: (W)arrior (G)uardian (S)cout<br>
    <span class="msg-player">You:</span> <span class="msg-gold">W</span><br>
    <span class="msg-server">meshMUD:</span> Kael the Warrior. POW:5 DEF:4 SPD:3 HP:30. You stand in the tavern. Type L.<br>
    <span class="msg-player">You:</span> <span class="msg-gold">L</span><br>
    <span class="msg-server">meshMUD:</span> The Last Ember. Lanterns burn without oil. Grist polishes a glass. Exits: dungeon.<br>
  </div>

  {# â•â•â• CLASSES â•â•â• #}
  <div class="divider">The Three Classes</div>

  <p class="prose">Three stats govern everything: <strong>POW</strong> (offense), <strong>DEF</strong> (survivability), and <strong>SPD</strong> (evasion, initiative, spellcasting). Each class leans into one. You earn 2 stat points per level to allocate however you want â€” that's where your build takes shape.</p>

  <div class="class-cards">
    <div class="class-card fighter">
      <div class="class-card-icon">âš”</div>
      <div class="class-card-name">Warrior</div>
      <div class="class-card-stat">POW-FOCUSED</div>
      <div class="class-card-desc">High HP. Hits hard. Takes hits. Abilities like Strike, Bash, Rally, Cleave. Passive damage reduction. The front line.</div>
    </div>
    <div class="class-card caster">
      <div class="class-card-icon">âœ¦</div>
      <div class="class-card-name">Guardian</div>
      <div class="class-card-stat">DEF-FOCUSED</div>
      <div class="class-card-desc">Protective abilities. Shield, Ward, Fortify, Taunt. Passive: see enemy stats. Keeps others alive. Endurance is the weapon.</div>
    </div>
    <div class="class-card rogue">
      <div class="class-card-icon">â—ˆ</div>
      <div class="class-card-name">Scout</div>
      <div class="class-card-stat">SPD-FOCUSED</div>
      <div class="class-card-desc">Stealth and utility. Stab, Dodge, Ambush, Steal. Passive evasion chance. Thrives in the spaces between fights.</div>
    </div>
  </div>

  {# â•â•â• A TYPICAL DAY â•â•â• #}
  <div class="divider">A Typical Day</div>

  <p class="prose">A session takes <strong>five to fifteen minutes</strong>. You get 12 dungeon actions per day â€” enough to explore a few rooms, fight a few monsters, and make progress without burning out. Town actions are always free.</p>

  <div class="flow-steps">
    <div class="flow-step">
      <div class="flow-step-num">1</div>
      <div class="flow-step-content">
        <div class="flow-step-label">Visit Grist</div>
        <div class="flow-step-text">The barkeep tells you what happened while you were gone. Who died, what fell, what the front line looks like. Always free. This is how the world stays alive between sessions.</div>
      </div>
    </div>
    <div class="flow-step">
      <div class="flow-step-num">2</div>
      <div class="flow-step-content">
        <div class="flow-step-label">Check the bounty board</div>
        <div class="flow-step-text">Shared objectives the whole server works toward. A monster with a communal HP pool. An exploration target. You chip away at it â€” so does everyone else.</div>
      </div>
    </div>
    <div class="flow-step">
      <div class="flow-step-num">3</div>
      <div class="flow-step-content">
        <div class="flow-step-label">Gear up</div>
        <div class="flow-step-text">Buy supplies from Torval, heal up with Maren if you need it, spend a bard token at the bar for a hint or buff. All free actions.</div>
      </div>
    </div>
    <div class="flow-step">
      <div class="flow-step-num">4</div>
      <div class="flow-step-content">
        <div class="flow-step-label">Enter the dungeon</div>
        <div class="flow-step-text">Move room to room, fight what you find, look for secrets, leave messages for other players. Each move or fight costs an action. Twelve per day â€” spend them wisely.</div>
      </div>
    </div>
    <div class="flow-step">
      <div class="flow-step-num">5</div>
      <div class="flow-step-content">
        <div class="flow-step-label">Return to town</div>
        <div class="flow-step-text">Bank your gold before the dungeon takes it. Tomorrow the rooms may have changed, the bounty may be weaker, and someone may have left you a message you need to read.</div>
      </div>
    </div>
  </div>

  {# â•â•â• THE TOWN â•â•â• #}
  <div class="divider">The Last Ember â€” Your Town</div>

  <p class="prose">The tavern is the one room that never changes. Epochs wipe the dungeon, reshuffle everything, reshape the world â€” but <em class="place">The Last Ember</em> stays. Same bar. Same people. Same lanterns that burn without oil and nobody questions anymore.</p>

  <p class="prose">Four people live here. They remember you across every wipe.</p>

  <div class="npc-guide">
    <span class="npc-guide-icon">ğŸº</span>
    <div>
      <div class="npc-guide-name">Grist</div>
      <div class="npc-guide-role">Barkeep</div>
      <div class="npc-guide-desc">Knows everything that happens in the dungeon because everyone tells him and he never forgets. Visit him first every session â€” he'll catch you up on what you missed. He also runs the bounty board, handles the epoch vote, and trades bard tokens for hints, buffs, and secrets. He doesn't trade because he's kind. He trades because he collects.</div>
    </div>
  </div>

  <div class="npc-guide">
    <span class="npc-guide-icon">ğŸ©¸</span>
    <div>
      <div class="npc-guide-name">Maren</div>
      <div class="npc-guide-role">Healer</div>
      <div class="npc-guide-desc">Used to be an adventurer. Went deeper than anyone. Came back done. Heals with her hands, not magic, and it hurts. She charges gold because free healing breeds carelessness. She's the reason you survive long enough to learn from your mistakes.</div>
    </div>
  </div>

  <div class="npc-guide">
    <span class="npc-guide-icon">âš–</span>
    <div>
      <div class="npc-guide-name">Torval</div>
      <div class="npc-guide-role">Merchant</div>
      <div class="npc-guide-desc">Buys and sells gear. Appraises items by weight and sound. His inventory somehow matches what's in the dungeon each epoch. Nobody asks how. His prices are fair and his stock is real, which is more than you can say for most people in a town built around a hole full of monsters.</div>
    </div>
  </div>

  <div class="npc-guide">
    <span class="npc-guide-icon">ğŸ‘</span>
    <div>
      <div class="npc-guide-name">Whisper</div>
      <div class="npc-guide-role">Sage</div>
      <div class="npc-guide-desc">Sits in the same corner. Knows things about the dungeon that change each epoch â€” lore, connections, what the symbols mean. Speaks in fragments because that's how the information comes to her. Pay attention to her exact words. Players who dismiss her as flavor text miss half the game.</div>
    </div>
  </div>

  {# â•â•â• THE DUNGEON â•â•â• #}
  <div class="divider">The Dungeon</div>

  <p class="prose">Four floors. Each one deeper, harder, and stranger than the last. Monsters get meaner. Secrets get subtler. The rooms change every epoch but the structure holds â€” floor one is where you learn, floor four is where legends are made.</p>

  <p class="prose">You carry three pieces of gear: a <strong>weapon</strong>, <strong>armor</strong>, and a <strong>trinket</strong>. The trinket is the wildcard â€” it might grant a passive ability, boost an unexpected stat, or do something no other slot can. Six tiers of gear across the dungeon. The best stuff doesn't come from shops.</p>

  <div class="callout frost">
    <div class="callout-label">Death</div>
    <p class="prose">Death costs you all the gold you're carrying. Not your gear. Not your level. Just your gold. The question is always the same: do you bank it before you go in, or carry it and risk losing everything? The dungeon teaches you the answer. Usually the hard way.</p>
  </div>

  {# â•â•â• MULTIPLAYER â•â•â• #}
  <div class="divider">Playing Together</div>

  <p class="prose">meshMUD is <strong>asynchronous multiplayer</strong>. You don't need to be online at the same time as anyone else. You see other players through what they leave behind â€” messages scratched on dungeon walls, bounty progress that wasn't there yesterday, broadcasts announcing who found what and who fell where.</p>

  <div class="tip-strip">
    <div class="tip-card">
      <div class="tip-card-label">Bounties</div>
      <div class="tip-card-text">Shared objectives with communal HP pools. You chip away at a target over days. Everyone who contributes shares the reward when it falls.</div>
    </div>
    <div class="tip-card">
      <div class="tip-card-label">Messages</div>
      <div class="tip-card-text">Leave 15-character notes in dungeon rooms for others to find. Warnings, tips, coordinates. Dark Souls soapstone, over LoRa.</div>
    </div>
    <div class="tip-card">
      <div class="tip-card-label">Mail</div>
      <div class="tip-card-text">Send direct messages to specific players through the barkeep. Coordinate strategy, share secrets, warn someone about what's ahead.</div>
    </div>
    <div class="tip-card">
      <div class="tip-card-label">Broadcasts</div>
      <div class="tip-card-text">Major events announce to the whole mesh. Boss kills, rare finds, deaths, front line changes. The world narrates itself.</div>
    </div>
  </div>

  <p class="prose">There is no PvP. All competition runs through leaderboards, bounty races, and endgame objectives. On a small mesh network where everyone knows each other, cooperation is the game.</p>

  {# â•â•â• EPOCHS â•â•â• #}
  <div class="divider">The 30-Day Epoch</div>

  <p class="prose">Every 30 days, the dungeon resets. New rooms, new monsters, new secrets, new narrative. Your character keeps their name and their history, but gear and gold start fresh. Each epoch has an <strong>endgame mode</strong> â€” a shared objective the whole server works toward. On day 30, players vote on the next epoch's mode.</p>

  <div class="callout gold">
    <div class="callout-label">Three endgame modes</div>
    <p class="prose"><strong>Hold the Line</strong> â€” the dungeon regenerates rooms. Push the front line deeper, establish checkpoints that lock in progress. The whole server descends together.</p>
    <p class="prose"><strong>Raid Boss</strong> â€” a massive enemy with thousands of HP squats on the lowest floor. The server chips away over days. Discover its weaknesses. Coordinate the kill.</p>
    <p class="prose"><strong>Retrieve &amp; Escape</strong> â€” an artifact on floor four. Grab it, carry it to the surface. Something unkillable chases the carrier. Other players clear the path, block the pursuer, relay the objective hand-to-hand.</p>
  </div>

  <p class="prose">On day 15, the <strong>Breach</strong> opens â€” a surprise mini-zone between floors two and three with its own challenge, its own loot, and its own secrets. You don't know what's inside until it opens.</p>

  {# â•â•â• SECRETS â•â•â• #}
  <div class="divider">Secrets &amp; Discovery</div>

  <p class="prose">Twenty secrets hide in the dungeon each epoch. Some are behind walls that need a strong arm to break. Some are puzzles spread across multiple rooms. Some are hidden in things Whisper says that nobody thinks to write down. Finding them isn't required â€” but every secret you uncover gives a real mechanical advantage, and some of them benefit the entire server.</p>

  <p class="prose"><strong>Read the room descriptions carefully.</strong> The dungeon tells you where its secrets are. It just doesn't tell you plainly.</p>

  {# â•â•â• COMMANDS â•â•â• #}
  <div class="divider">Quick Command Reference</div>

  <p class="prose">Every command fits in a short message. Most have single-letter shortcuts. New commands unlock as you level up â€” the game teaches you as you go.</p>

  <div class="callout ember">
    <div class="callout-label">Movement &amp; Awareness</div>
    <div class="cmd-grid">
      <span class="cmd-key">n s e w</span><span class="cmd-desc">Move north, south, east, west</span>
      <span class="cmd-key">l</span><span class="cmd-desc">Look â€” describe current room, show exits</span>
      <span class="cmd-key">x [thing]</span><span class="cmd-desc">Examine something in the room <span class="cmd-unlock">LV5</span></span>
      <span class="cmd-key">who</span><span class="cmd-desc">List active players <span class="cmd-unlock">LV3</span></span>
    </div>
  </div>

  <div class="callout blood">
    <div class="callout-label">Combat</div>
    <div class="cmd-grid">
      <span class="cmd-key">f</span><span class="cmd-desc">Fight â€” engage the monster in this room</span>
      <span class="cmd-key">a</span><span class="cmd-desc">Attack â€” basic melee/spell attack</span>
      <span class="cmd-key">flee</span><span class="cmd-desc">Attempt to escape combat (SPD-based chance)</span>
    </div>
  </div>

  <div class="callout gold">
    <div class="callout-label">Town &amp; NPCs</div>
    <div class="cmd-grid">
      <span class="cmd-key">barkeep</span><span class="cmd-desc">Talk to Grist â€” recap, tokens, bounties <span class="cmd-unlock">LV3</span></span>
      <span class="cmd-key">heal</span><span class="cmd-desc">Visit Maren â€” restore HP for gold <span class="cmd-unlock">LV3</span></span>
      <span class="cmd-key">shop</span><span class="cmd-desc">Browse Torval's inventory <span class="cmd-unlock">LV3</span></span>
      <span class="cmd-key">bank</span><span class="cmd-desc">Deposit gold safely <span class="cmd-unlock">LV3</span></span>
      <span class="cmd-key">board</span><span class="cmd-desc">View active bounties <span class="cmd-unlock">LV3</span></span>
    </div>
  </div>

  <div class="callout frost">
    <div class="callout-label">Inventory &amp; Character</div>
    <div class="cmd-grid">
      <span class="cmd-key">i</span><span class="cmd-desc">Inventory â€” show gear and backpack <span class="cmd-unlock">LV2</span></span>
      <span class="cmd-key">st</span><span class="cmd-desc">Stats â€” show POW, DEF, SPD, HP, gold, level</span>
      <span class="cmd-key">equip [item]</span><span class="cmd-desc">Equip an item from your backpack <span class="cmd-unlock">LV2</span></span>
      <span class="cmd-key">use [item]</span><span class="cmd-desc">Use a consumable <span class="cmd-unlock">LV2</span></span>
    </div>
  </div>

  <div class="callout ember">
    <div class="callout-label">Social</div>
    <div class="cmd-grid">
      <span class="cmd-key">msg [text]</span><span class="cmd-desc">Leave a 15-char message in this room <span class="cmd-unlock">LV5</span></span>
      <span class="cmd-key">read</span><span class="cmd-desc">Read messages in this room</span>
      <span class="cmd-key">rate</span><span class="cmd-desc">Mark a message as helpful</span>
      <span class="cmd-key">mail</span><span class="cmd-desc">Check your inbox <span class="cmd-unlock">LV3</span></span>
      <span class="cmd-key">mail [who] [text]</span><span class="cmd-desc">Send mail to a player <span class="cmd-unlock">LV3</span></span>
    </div>
  </div>

  <div class="callout gold">
    <div class="callout-label">Meta</div>
    <div class="cmd-grid">
      <span class="cmd-key">h</span><span class="cmd-desc">Help â€” list all available commands</span>
      <span class="cmd-key">h [cmd]</span><span class="cmd-desc">Help on a specific command</span>
      <span class="cmd-key">vote</span><span class="cmd-desc">Vote for next epoch's mode (day 30 only) <span class="cmd-unlock">LV1</span></span>
    </div>
  </div>

  {# â•â•â• TIPS â•â•â• #}
  <div class="divider">Grist's Advice for the New Arrival</div>

  <div class="callout ember">
    <div class="callout-label">Things nobody tells you</div>
    <p class="prose"><strong>Bank before you descend.</strong> Death takes everything you're carrying. Not your gear, not your level â€” just your gold. The bank is free. Use it.</p>
    <p class="prose"><strong>Visit Grist every session.</strong> His recap costs nothing and tells you everything you missed. The bounty board is there too. Five seconds of reading saves you from walking into something that killed Sable yesterday.</p>
    <p class="prose"><strong>Leave messages.</strong> A 15-character note in a dangerous room saves someone's life tomorrow. This is a small network. Help each other.</p>
    <p class="prose"><strong>Read room descriptions.</strong> The dungeon hides things in plain sight. If the text mentions scratches on a wall, there's a reason. If Whisper mumbles about the eastern branch, there's a reason. The game rewards attention.</p>
    <p class="prose"><strong>You don't have to fight everything.</strong> Twelve actions is enough for a good day, not enough for a reckless one. Know when to push and when to walk away. The dungeon will be here tomorrow.</p>
    <p class="prose"><strong>Bard tokens accrue whether you log in or not.</strong> One per day, cap at five. Spend them at the barkeep for things gold can't buy â€” hints, buffs, intel. A patient player who saves five tokens gets information that changes everything.</p>
  </div>
{% endblock %}

{% block ember_init %}
  if (window.initEmbers) initEmbers(25, 0.35);
{% endblock %}
